# ü§ñ –ì–∞–π–¥ –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ YT Zavod

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å YouTube –∫–∞–Ω–∞–ª–∞–º–∏ –∏ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ n8n, Telegram –±–æ—Ç–∞ –∏ Whisper AI.

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π](#–æ–±–∑–æ—Ä-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π)
2. [Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–∞–º–∏](#telegram-–±–æ—Ç)
3. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è —á–µ—Ä–µ–∑ Whisper](#whisper-—Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è)
4. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-n8n)
5. [API –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏](#api-–¥–ª—è-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏)
6. [–ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤](#–ø—Ä–∏–º–µ—Ä—ã-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤)

---

## üéØ –û–±–∑–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

### –ß—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:

‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏ —á–µ—Ä–µ–∑ Telegram**
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –∫–æ–º–∞–Ω–¥–∞–º–∏ –±–æ—Ç–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- –ë–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≤–∏–¥–µ–æ**
- Whisper AI (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ —á–µ—Ä–µ–∑ OpenAI API)
- Fallback –Ω–∞ YouTube —Å—É–±—Ç–∏—Ç—Ä—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —è–∑—ã–∫–æ–≤

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å–ª–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è**
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–π–º–∫–æ–¥–æ–≤ –∏–∑ chapters
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞/—Å—É–±—Ç–∏—Ç—Ä–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google Sheets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ n8n webhook**
- –°–æ–±—ã—Ç–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–æ–≤—ã—Ö –≤–∏–¥–µ–æ**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –Ω–æ–≤—ã—Ö –≤–∏–¥–µ–æ
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

---

## ü§ñ Telegram –±–æ—Ç

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –¥–ª—è –±–æ—Ç–∞

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ YT Zavod API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```bash
# –ü–æ–ª—É—á–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω (–≤–æ–π–¥–∏—Ç–µ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ localStorage)
# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å:
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"login":"admin","password":"your_password"}'

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)
curl -X POST http://localhost:3000/api/telegram/set-webhook \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"url":"https://your-backend-url.com/api/telegram/webhook"}'
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Telegram API**

```bash
curl -X POST "https://api.telegram.org/bot<BOT_TOKEN>/setWebhook" \
  -d "url=https://your-backend-url.com/api/telegram/webhook"
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

```bash
curl -X GET http://localhost:3000/api/telegram/webhook-info \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "data": {
    "url": "https://your-backend-url.com/api/telegram/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

**`/start`** - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
```
/start
```

**`/add_channel <URL>`** - –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
```
/add_channel https://youtube.com/@channel
/add_channel https://youtube.com/c/ChannelName
/add_channel UCxxxxxxxxxxxxxxxxxxxxxx
```

**`/list_channels`** - –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –∫–∞–Ω–∞–ª—ã
```
/list_channels
```

**`/remove_channel <ID>`** - –£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª –∏–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
```
/remove_channel UCxxxxxxxxxxxxxxxxxxxxxx
```

**`/help`** - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
```
/help
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

- –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã
- –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∫–∞–Ω–∞–ª—ã
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç –≤—Å–µ –∫–∞–Ω–∞–ª—ã

---

## üé§ Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

#### –í–∞—Ä–∏–∞–Ω—Ç A: OpenAI Whisper API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç GPU
- ‚úÖ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
- ‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á: https://platform.openai.com/api-keys
2. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```bash
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxx
ENABLE_ASR_IF_NO_CAPTIONS=1
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- ~$0.006 –∑–∞ –º–∏–Ω—É—Ç—É –∞—É–¥–∏–æ
- –í–∏–¥–µ–æ 10 –º–∏–Ω—É—Ç ‚âà $0.06
- 1000 –≤–∏–¥–µ–æ –ø–æ 10 –º–∏–Ω ‚âà $60

#### –í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω—ã–π Whisper

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω
- ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Python 3.8+
- ffmpeg
- PyTorch (—Å CUDA –¥–ª—è GPU –∏–ª–∏ CPU –≤–µ—Ä—Å–∏—è)
- ~1-10 GB –ø–∞–º—è—Ç–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏)

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
cd python-workers

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ffmpeg
# Windows: choco install ffmpeg
# Linux: sudo apt install ffmpeg
# macOS: brew install ffmpeg

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Whisper
pip install openai-whisper

# GPU –≤–µ—Ä—Å–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å NVIDIA GPU)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# CPU –≤–µ—Ä—Å–∏—è (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
pip install torch torchvision torchaudio
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `.env`:**
```bash
# –û—Ç–∫–ª—é—á–∏—Ç–µ OpenAI API (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ OPENAI_API_KEY)
# OPENAI_API_KEY=

# –í–∫–ª—é—á–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π Whisper
ENABLE_ASR_IF_NO_CAPTIONS=1
```

**–ú–æ–¥–µ–ª–∏ Whisper:**

| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä | –°–∫–æ—Ä–æ—Å—Ç—å | –ö–∞—á–µ—Å—Ç–≤–æ | –ü–∞–º—è—Ç—å |
|--------|--------|----------|----------|--------|
| tiny   | 39 MB  | 32x      | ‚≠ê‚≠ê     | ~1 GB  |
| base   | 74 MB  | 16x      | ‚≠ê‚≠ê‚≠ê   | ~1 GB  |
| small  | 244 MB | 6x       | ‚≠ê‚≠ê‚≠ê‚≠ê | ~2 GB  |
| medium | 769 MB | 2x       | ‚≠ê‚≠ê‚≠ê‚≠ê | ~5 GB  |
| large  | 1550 MB| 1x       | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê| ~10 GB |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è

–ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –≤–∏–¥–µ–æ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å YouTube —Å—É–±—Ç–∏—Ç—Ä—ã
2. –ï—Å–ª–∏ —Å—É–±—Ç–∏—Ç—Ä–æ–≤ –Ω–µ—Ç –∏ `ENABLE_ASR_IF_NO_CAPTIONS=1`:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI API (–µ—Å–ª–∏ –µ—Å—Ç—å `OPENAI_API_KEY`)
   - –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π Whisper (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ JSON —Ñ–∞–π–ª

#### –†—É—á–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è

```bash
cd python-workers

# –ß–µ—Ä–µ–∑ OpenAI API
OPENAI_API_KEY=sk-xxx python video_parser.py VIDEO_ID --languages en ru

# –õ–æ–∫–∞–ª—å–Ω—ã–π Whisper (–º–æ–¥–µ–ª—å base)
python video_parser.py VIDEO_ID --whisper-model base --languages en

# –õ–æ–∫–∞–ª—å–Ω—ã–π Whisper (–º–æ–¥–µ–ª—å medium, –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
python video_parser.py VIDEO_ID --whisper-model medium
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏

```json
{
  "transcript": {
    "language": "en",
    "type": "whisper_api",
    "source": "openai_whisper_api",
    "segments": [
      {
        "start": 0.0,
        "duration": 5.2,
        "text": "Welcome to this tutorial on YouTube automation"
      },
      {
        "start": 5.2,
        "duration": 4.8,
        "text": "Today we'll learn how to parse videos"
      }
    ]
  },
  "full_text": "Welcome to this tutorial on YouTube automation. Today we'll learn how to parse videos..."
}
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å n8n

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ n8n

**Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**

```bash
docker run -d \
  --name n8n \
  -p 5678:5678 \
  -e N8N_BASIC_AUTH_ACTIVE=true \
  -e N8N_BASIC_AUTH_USER=admin \
  -e N8N_BASIC_AUTH_PASSWORD=your_password \
  -e WEBHOOK_URL=https://your-n8n-domain.com/ \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
```

**npm:**

```bash
npm install -g n8n
n8n start
```

### –ò–º–ø–æ—Ä—Ç workflows

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n: `http://localhost:5678`
2. –í–æ–π–¥–∏—Ç–µ (admin / your_password)
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ workflows –∏–∑ `n8n-workflows/`:
   - `telegram-add-channel.json`
   - `video-auto-parse.json`
   - `monitor-channels.json`

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [`n8n-workflows/README.md`](./n8n-workflows/README.md)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

–í n8n –¥–æ–±–∞–≤—å—Ç–µ Environment Variables:

```bash
BACKEND_URL=https://your-backend-url.com
TELEGRAM_ADMIN_CHAT_ID=123456789
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Credentials

#### 1. YT Zavod API Token

**Settings ‚Üí Credentials ‚Üí New ‚Üí HTTP Header Auth**

- Name: `YT Zavod API Token`
- Header Name: `Authorization`
- Header Value: `Bearer YOUR_JWT_TOKEN`

**–ü–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞:**

```bash
# –ß–µ—Ä–µ–∑ API
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"login":"admin","password":"your_password"}'

# –û—Ç–≤–µ—Ç:
# {"success":true,"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."}
```

–ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ localStorage –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

#### 2. Telegram Bot

**Settings ‚Üí Credentials ‚Üí New ‚Üí Telegram**

- Name: `Telegram Bot`
- Access Token: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`

---

## üîå API –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

### Telegram Webhook

#### POST `/api/telegram/webhook`

–ü—Ä–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Telegram –±–æ—Ç–∞.

**Request:**
```json
{
  "update_id": 123456,
  "message": {
    "message_id": 1,
    "from": {
      "id": 123456789,
      "first_name": "John"
    },
    "chat": {
      "id": 123456789
    },
    "text": "/add_channel https://youtube.com/@channel"
  }
}
```

**Response:**
```json
{
  "ok": true
}
```

#### POST `/api/telegram/set-webhook`

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook URL –¥–ª—è –±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä).

**Headers:**
```
Authorization: Bearer YOUR_JWT_TOKEN
```

**Request:**
```json
{
  "url": "https://your-backend-url.com/api/telegram/webhook"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω",
  "data": {
    "ok": true,
    "result": true,
    "description": "Webhook was set"
  }
}
```

### Video Transcript

#### GET `/api/videos/:videoId/transcript`

–ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –≤–∏–¥–µ–æ.

**Headers:**
```
Authorization: Bearer YOUR_JWT_TOKEN
```

**Response:**
```json
{
  "success": true,
  "data": {
    "videoId": "dQw4w9WgXcQ",
    "title": "Video Title",
    "fullText": "Full transcript text...",
    "transcript": {
      "language": "en",
      "type": "whisper_api",
      "segments": [...]
    },
    "chapters": [
      {
        "start_time": 0,
        "title": "Introduction"
      }
    ],
    "parsed": true
  }
}
```

### n8n Webhook

#### POST `/api/videos/webhook/n8n`

–ü—Ä–∏–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç —Å–∏—Å—Ç–µ–º—ã –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞.

**Request:**
```json
{
  "event": "video-parsed",
  "videoId": "dQw4w9WgXcQ",
  "status": "completed",
  "result": {
    "transcript": {...},
    "chapters": [...],
    "full_text": "..."
  },
  "timestamp": "2025-11-17T12:00:00.000Z"
}
```

**Response:**
```json
{
  "success": true,
  "received": true
}
```

### Channels API

#### GET `/api/channels/activities`

–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∏–¥–µ–æ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∫–∞–Ω–∞–ª–æ–≤.

**Headers:**
```
Authorization: Bearer YOUR_JWT_TOKEN
```

**Query Parameters:**
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10, –º–∞–∫—Å 50)

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "videoId": "abc123",
      "title": "New Video",
      "channelTitle": "Channel Name",
      "channelId": "UCxxxx",
      "publishedAt": "2025-11-17T10:00:00Z",
      "views": 12345,
      "likes": 567
    }
  ]
}
```

---

## üí° –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, —Å–∫–∞—á–∏–≤–∞—Ç—å –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤–∏–¥–µ–æ.

**–®–∞–≥–∏:**

1. **–î–æ–±–∞–≤—å—Ç–µ –∫–∞–Ω–∞–ª—ã —á–µ—Ä–µ–∑ Telegram:**
   ```
   /add_channel https://youtube.com/@competitor1
   /add_channel https://youtube.com/@competitor2
   /add_channel https://youtube.com/@competitor3
   ```

2. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow "Monitor Channels"** –≤ n8n:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–∏–¥–µ–æ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥

3. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ workflow "Video Auto Parse"**:
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google Sheets (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```bash
AUTO_PARSE_AFTER_DOWNLOAD=true
N8N_WEBHOOK_URL=https://your-n8n.com/webhook/video-parsed
OPENAI_API_KEY=sk-xxx
ENABLE_ASR_IF_NO_CAPTIONS=1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞.

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç

**–¶–µ–ª—å:** –ü–æ–ª—É—á–∞—Ç—å –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º –Ω–æ–≤—ã–º –≤–∏–¥–µ–æ.

**n8n Workflow:**

```
Schedule (–∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 9:00)
  ‚Üì
Get Activities (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
  ‚Üì
Filter Videos (—Ç–æ–ª—å–∫–æ —Å >1000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤)
  ‚Üì
Create Report (—Å–ø–∏—Å–æ–∫ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
  ‚Üì
Send to Email/Telegram
```

**–ö–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞:**
```javascript
const activities = $input.item.json.data || [];
const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);

return activities
  .filter(v => {
    const publishedDate = new Date(v.publishedAt);
    const views = v.views || 0;
    return publishedDate > weekAgo && views > 1000;
  })
  .map(v => ({ json: v }));
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: AI –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã —á–µ—Ä–µ–∑ ChatGPT.

**n8n Workflow:**

```
Webhook (video-parsed)
  ‚Üì
Get Transcript
  ‚Üì
OpenAI (ChatGPT): "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç –∏ –≤—ã–¥–µ–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º—ã"
  ‚Üì
Save to Notion/Airtable
  ‚Üì
Notify Telegram
```

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è ChatGPT:**
```
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç YouTube –≤–∏–¥–µ–æ –∏ –≤—ã–¥–µ–ª–∏:
1. 5 –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º
2. –û—Å–Ω–æ–≤–Ω—ã–µ –∏–¥–µ–∏
3. –¶–∏—Ç–∞—Ç—ã –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö

–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç:
{{$json.fullText}}
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è

**–¶–µ–ª—å:** –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ª—É—á—à–∏–µ —Ü–∏—Ç–∞—Ç—ã –∏–∑ –≤–∏–¥–µ–æ –≤ Twitter/VK.

**n8n Workflow:**

```
Schedule (–∫–∞–∂–¥—ã–µ 4 —á–∞—Å–∞)
  ‚Üì
Get Random Transcript (—Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–º)
  ‚Üì
OpenAI: "–í—ã–±–µ—Ä–∏ –ª—É—á—à—É—é —Ü–∏—Ç–∞—Ç—É –∏–∑ –≤–∏–¥–µ–æ"
  ‚Üì
Post to Twitter/VK
  ‚Üì
Log to Database
```

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Backend (.env)

```bash
# API
YOUTUBE_API_KEY=xxx
OPENAI_API_KEY=xxx

# Telegram
TELEGRAM_BOT_TOKEN=xxx
TELEGRAM_BOT_USERNAME=xxx

# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
AUTO_PARSE_AFTER_DOWNLOAD=true
N8N_WEBHOOK_URL=https://n8n.example.com/webhook/video-parsed
ENABLE_ASR_IF_NO_CAPTIONS=1

# Redis (–¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π)
REDIS_HOST=localhost
REDIS_PORT=6379
```

### n8n Environment

```bash
BACKEND_URL=https://your-backend.com
TELEGRAM_ADMIN_CHAT_ID=123456789
```

---

## üêõ Troubleshooting

### Telegram –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook: `GET /api/telegram/webhook-info`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend: `npm run dev`

### Whisper –æ—à–∏–±–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** `[WARN] –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ openai-whisper –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`

**–†–µ—à–µ–Ω–∏—è:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OpenAI API –∫–ª—é—á (–±—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ)
2. –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π Whisper:
   ```bash
   pip install openai-whisper torch
   ```

### n8n webhook –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** Backend –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `N8N_WEBHOOK_URL` –≤ `.env`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Production URL, –Ω–µ Test URL
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ n8n –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n: Executions

### –ê–≤—Ç–æ–ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–∏–¥–µ–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è

**–†–µ—à–µ–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `AUTO_PARSE_AFTER_DOWNLOAD=true` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—á–µ—Ä–µ–¥–∏: `GET /api/videos/queue?queueType=parse`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [n8n Documentation](https://docs.n8n.io/)
- [n8n Community](https://community.n8n.io/)
- [OpenAI Whisper](https://platform.openai.com/docs/guides/speech-to-text)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [YT Zavod n8n Workflows](./n8n-workflows/README.md)

---

**–£—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏! üöÄ**
