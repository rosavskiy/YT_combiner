import express from 'express';
import axios from 'axios';

const router = express.Router();

/**
 * POST /api/generator/translate
 * Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾ Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¾Ğ¼
 */
router.post('/translate', async (req, res) => {
  try {
    const { videoId, targetLanguages } = req.body;
    
    if (!videoId || !targetLanguages || !Array.isArray(targetLanguages)) {
      return res.status(400).json({
        success: false,
        error: 'videoId Ğ¸ targetLanguages (Ğ¼Ğ°ÑÑĞ¸Ğ²) Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹'
      });
    }

    // TODO: Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Python worker
    // const pythonWorkerUrl = process.env.PYTHON_WORKER_URL || 'http://localhost:5000';
    // const response = await axios.post(`${pythonWorkerUrl}/generate`, {
    //   videoId,
    //   targetLanguages
    // });

    res.json({
      success: true,
      message: 'Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ° (TODO: Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Python worker)',
      videoId,
      targetLanguages
    });
  } catch (error) {
    console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

/**
 * GET /api/generator/status/:taskId
 * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
 */
router.get('/status/:taskId', async (req, res) => {
  try {
    // TODO: ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸Ğ· Python worker
    res.json({
      success: true,
      taskId: req.params.taskId,
      status: 'pending',
      message: 'TODO: Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Python worker'
    });
  } catch (error) {
    console.error('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

/**
 * GET /api/generator/languages
 * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ² Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°
 */
router.get('/languages', (req, res) => {
  const languages = [
    { code: 'en', name: 'English', flag: 'ğŸ‡¬ğŸ‡§' },
    { code: 'ru', name: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', flag: 'ğŸ‡·ğŸ‡º' },
    { code: 'de', name: 'Deutsch', flag: 'ğŸ‡©ğŸ‡ª' },
    { code: 'fr', name: 'FranÃ§ais', flag: 'ğŸ‡«ğŸ‡·' },
    { code: 'es', name: 'EspaÃ±ol', flag: 'ğŸ‡ªğŸ‡¸' },
    { code: 'it', name: 'Italiano', flag: 'ğŸ‡®ğŸ‡¹' },
    { code: 'pt', name: 'PortuguÃªs', flag: 'ğŸ‡µğŸ‡¹' },
    { code: 'nl', name: 'Nederlands', flag: 'ğŸ‡³ğŸ‡±' },
    { code: 'sv', name: 'Svenska', flag: 'ğŸ‡¸ğŸ‡ª' },
    { code: 'no', name: 'Norsk', flag: 'ğŸ‡³ğŸ‡´' },
    { code: 'da', name: 'Dansk', flag: 'ğŸ‡©ğŸ‡°' },
    { code: 'fi', name: 'Suomi', flag: 'ğŸ‡«ğŸ‡®' },
    { code: 'ja', name: 'æ—¥æœ¬èª', flag: 'ğŸ‡¯ğŸ‡µ' },
    { code: 'ko', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' },
    { code: 'zh', name: 'ä¸­æ–‡', flag: 'ğŸ‡¨ğŸ‡³' },
    { code: 'he', name: '×¢×‘×¨×™×ª', flag: 'ğŸ‡®ğŸ‡±' }
  ];

  res.json({
    success: true,
    count: languages.length,
    languages
  });
});

export default router;
