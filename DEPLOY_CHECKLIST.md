# üöÄ –ß–µ–∫-–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è —Å Whisper AI

## –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º (–ª–æ–∫–∞–ª—å–Ω–æ)

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –≤ Git
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Ñ–∞–π–ª—ã:
  - [ ] `backend/src/services/videoDownloadService.js` - –ø–µ—Ä–µ–¥–∞—á–∞ OpenAI –∫–ª—é—á–µ–π
  - [ ] `python-workers/video_parser.py` - –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –≤ Google Sheets
  - [ ] `python-workers/requirements.txt` - `openai>=1.40.0` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Frontend —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è (`npm run build`)
- [ ] Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Whisper (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á)

### 3. Git
```bash
git status
git add .
git commit -m "feat: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Whisper AI –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –≤–∏–¥–µ–æ"
git push origin main
```

---

## –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/var/www/yt-combiner/.env`:**

```bash
# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≥–ª–æ–±–∞–ª—å–Ω—ã–π OpenAI –∫–ª—é—á (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ)
OPENAI_API_KEY=sk-proj-xxxxx

# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å Whisper –µ—Å–ª–∏ –Ω–µ—Ç —Å—É–±—Ç–∏—Ç—Ä–æ–≤
ENABLE_ASR_IF_NO_CAPTIONS=1

# –ú–æ–¥–µ–ª—å Whisper
ASR_MODEL=whisper-1

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∞—É–¥–∏–æ –¥–ª—è ASR (100MB)
ASR_MAX_BYTES=104857600
```

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
```bash
sudo chmod 600 /var/www/yt-combiner/.env
sudo chown www-data:www-data /var/www/yt-combiner/.env
```

### 2. –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

```bash
cd /var/www/yt-combiner
sudo ./deploy.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç deploy.sh:**
1. ‚úÖ –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ Git
2. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç backend –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
3. ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç frontend
4. ‚úÖ –°–æ–∑–¥–∞—ë—Ç Python venv (–µ—Å–ª–∏ –Ω–µ—Ç)
5. ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è `openai>=1.40.0`)
6. ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
7. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã —Å `--update-env`
8. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç Nginx

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã:
```bash
pm2 status
pm2 logs yt-combiner-backend --lines 50
pm2 logs yt-combiner-python --lines 50
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
yt-combiner-backend  ‚îÇ ‚úÖ SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
yt-combiner-backend  ‚îÇ üöÄ Server running on port 3000
yt-combiner-python   ‚îÇ * Running on http://0.0.0.0:5000
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
cd /var/www/yt-combiner/python-workers
source venv/bin/activate
pip list | grep openai
python -c "import openai; print(openai.__version__)"
deactivate
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
openai    1.40.0 (–∏–ª–∏ –≤—ã—à–µ)
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx:
```bash
sudo tail -f /var/log/nginx/yt-combiner-error.log
sudo tail -f /var/log/nginx/yt-combiner-access.log
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Whisper –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

#### –ß–µ—Ä–µ–∑ Web UI:
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ **–ü—Ä–æ—Ñ–∏–ª—å ‚Üí API –∫–ª—é—á–∏**
4. –î–æ–±–∞–≤—å—Ç–µ OpenAI –∫–ª—é—á
5. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ**
6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–∞—Ä—Å–∏–Ω–≥ –≤–∏–¥–µ–æ –±–µ–∑ —Å—É–±—Ç–∏—Ç—Ä–æ–≤

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
```bash
pm2 logs yt-combiner-backend --lines 100 | grep -A 5 "Parser"
```

**–û–∂–∏–¥–∞–µ–º—ã–µ —Å—Ç—Ä–æ–∫–∏:**
```
[Parser] –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π OpenAI –∫–ª—é—á –¥–ª—è userId: X
[Python] [INFO] –°—É–±—Ç–∏—Ç—Ä–æ–≤ –Ω–µ—Ç ‚Äî –ø—Ä–æ–±—É–µ–º OpenAI Whisper API
[Python] [SUCCESS] –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞: N —Å–µ–≥–º–µ–Ω—Ç–æ–≤
```

---

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå "openai module not found"

**–ü—Ä–∏—á–∏–Ω–∞:** Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ venv

**–†–µ—à–µ–Ω–∏–µ:**
```bash
cd /var/www/yt-combiner/python-workers
source venv/bin/activate
pip install openai>=1.40.0
deactivate
pm2 restart yt-combiner-python
```

### ‚ùå "OPENAI_API_KEY –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–ª—é—á –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–∏–ª –∫–ª—é—á —á–µ—Ä–µ–∑ –ü—Ä–æ—Ñ–∏–ª—å
2. –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–ª—é—á –≤ `.env`

### ‚ùå PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–≤–∏—Å–ª–∏

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pm2 delete all
pm2 start /var/www/yt-combiner/ecosystem.config.js
pm2 save
```

### ‚ùå Nginx 502 Bad Gateway

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pm2 restart yt-combiner-backend
pm2 logs yt-combiner-backend --err
```

### ‚ùå Python venv –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –∏–ª–∏ –Ω–µ—Ç python3-venv

**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo apt install python3-venv
cd /var/www/yt-combiner/python-workers
sudo rm -rf venv
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
deactivate
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –ü–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞:

**–ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∂–¥—ã–π —á–∞—Å:**
```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 status

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
pm2 monit

# –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
pm2 logs --err --lines 20
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OpenAI API**
   - –ó–∞–π—Ç–∏ –Ω–∞ [platform.openai.com/usage](https://platform.openai.com/usage)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –Ω–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç

2. **–†–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤**
   ```bash
   du -sh /root/.pm2/logs/
   ```
   –ï—Å–ª–∏ > 1GB ‚Üí –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é:
   ```bash
   pm2 install pm2-logrotate
   pm2 set pm2-logrotate:max_size 100M
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞**
   ```bash
   df -h /var/www
   du -sh /var/www/yt-combiner/python-workers/*.json
   ```
   –ï—Å–ª–∏ JSON —Ñ–∞–π–ª–æ–≤ –º–Ω–æ–≥–æ ‚Üí –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É

---

## –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç:
```bash
cd /var/www/yt-combiner
git log --oneline -5  # –ù–∞–π—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
git reset --hard <COMMIT_HASH>
sudo ./deploy.sh
```

### –û—Ç–∫–∞—Ç —Ç–æ–ª—å–∫–æ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
cd /var/www/yt-combiner/python-workers
git checkout HEAD~1 requirements.txt
source venv/bin/activate
pip install -r requirements.txt
deactivate
pm2 restart yt-combiner-python
```

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –°–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç—Ä–µ–Ω–¥–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ –≤–∏–¥–µ–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] Whisper –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∏–¥–µ–æ –±–µ–∑ —Å—É–±—Ç–∏—Ç—Ä–æ–≤
- [ ] Google Sheets –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è (–∫–æ–ª–æ–Ω–∫–∞ J —Å —Ç–µ–∫—Å—Ç–æ–º)
- [ ] –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [ ] PM2 –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ —Å—Ç–∞—Ç—É—Å–µ `online`
- [ ] Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK
- [ ] OpenAI –±–∞–ª–∞–Ω—Å –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–õ–æ–≥–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:**
```bash
# –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
pm2 logs --lines 500 --nostream > ~/deploy_logs.txt
sudo tail -100 /var/log/nginx/yt-combiner-error.log >> ~/deploy_logs.txt
cat /var/www/yt-combiner/.env >> ~/deploy_logs.txt  # –£–±–µ—Ä–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π!
```

**–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Python
python3 --version

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
pip list

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è PM2
pm2 env 0

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã
sudo netstat -tulpn | grep LISTEN
```

---

**–î–µ–ø–ª–æ–π –≥–æ—Ç–æ–≤! üöÄ**
